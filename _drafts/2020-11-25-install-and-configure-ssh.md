---
layout: post
title: Установка и настройка подключения по SSH
tags: windows linux ssh
---
Установка и настройка подключения по SSH.

---

## Установка и настройка SSH

Я подключаюсь с Windows машины или из под Ubuntu к серверу с Debian или Ubuntu. Чтобы установить SSH используем в debian-based дистрибутивах.
```
sudo apt-get install ssh
```
После завершения установки будет запущен SSH-сервер в режиме демона. Это можно проверить командой:
```
systemctl status sshd
```
или:
```
service sshd status
``` 
Теперь сервер работает с базовыми настройками по-умолчанию. К серверу уже можно подключиться по SSH, и это нормально работает в частных сетях, однако лучше бы исправить некоторые параметры для работы в публичных сетях. Настройки хранятся в файле по адресу **/etc/ssh/sshd_config**. Посмотреть его можно командой
```
cat /etc/ssh/sshd_config
```
Для редактирования вы можете использовать любой редактоор, я использую nano.
```
nano /etc/ssh/sshd_config
```
Обратим внимание на параметры **Port, AddressFamily, ListenAddress** 
**Port** задает номер порта, через который будет работать соединение, стандартный порт 22, часто подвергается сканированию ботами. Чтобы задать параметр убираем символ # в начале строки и указываем нужное значение, например 58292. Главное, чтобы порт не конфликтовал  с другими портами в системе, mysqld использует порт 3306, httpd — 80, ftpd — 21, поэтому выбирайте пятизначное значение, но не больше 65535.
```
Port 58292
```
**AddressFamily** задает семейство используемых адресов, IPv4 и IPv6, если используются только IPv4 адреса, то IPv6 можно отключить. AddressFamily **inet** - для IPv4 адресов и AddressFamily **inet6** для IPv6 адресов. По-умолчанию значение **any**.
```
AddressFamily inet
```
**PubkeyAuthentication** позволяет проводить авторизацию и шифрование трафика с помощью SSH-ключей.
 ```
PubkeyAuthentication yes
```
Также серверу можно явно указать, где хранятся открытые ключи пользователей. Это может быть как один общий файл для хранения ключей всех пользователей (обычно это файл etc/.ssh/authorized_keys), так и отдельные для каждого пользователя ключи. Второй вариант предпочтительнее в силу удобства администрирования и повышения безопасности.
Для общего файла:
```
AuthorizedKeysFile etc/ssh/authorized_keys
```
Для каждого пользователя. Благодаря шаблону автоподстановки с маской «%h» будет использоваться домашний каталог пользователя.
```
AuthorizedKeysFile %h/.ssh/authorized_keys
```
Обратите внимание, что вариант по-умолчанию
```
AuthorizedKeysFile .ssh/authorized_keys
```

Также безопасности ради можно отключить парольный доступ.
```
PasswordAuthentication no
```
И обязательно отключить идентификацию по пустому паролю:
```
PermitEmptyPasswords no
```
Следует также отключать root-доступ:
```
PermitRootLogin no
```
Значение по-умолчанию **PermitRootLogin prohibit-password** т.е. удалённый вход под пользователем root с парольной и интерактивной аутентификацией теперь запрещён. При указании значений without-password или prohibit-password допускается только аутентификация по ключам.

Для применения сделанных настроек необходим перезапуск SSH-сервера:
```
systemctl restart sshd
```
или
```
service sshd restart
```

Для подключения к серверу используется команда:
```
ssh user_name@host_name
```
Где user_name - имя пользователя. А host_name имя или ip адрес узла к которому производится подключение. Например:
```
ssh fred@192.168.1.25
```
При этом утилита ssh запросит (в зависимости от настроек сервера) логин, пароль или парольную фразу для разблокировки приватного ключа пользователя.

## Создание и настройка SSH ключей
